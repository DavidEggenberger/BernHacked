@inject HttpClientService httpClientService

@if(Message.MessageType == MessageTypeDTO.PulseExercise)
{
        
}
else if(Message.MessageType == MessageTypeDTO.Question)
{
    <div class="Message @Styling" style="@(Message.MessageType == MessageTypeDTO.Question ? "align-self: center; text-align: center;" : string.Empty)">
        @Message.Text
            <div class="AnswerSection">
                @foreach(var answer in Message.Answers)
                {
                    <button @onclick="async() => await ChooseAnswerForQuestion(Message.Text, answer)">
                        @answer
                    </button>
                }
            </div>
    </div>
}
else
{
    <div class="Message @Styling" style="@(Message.MessageType == MessageTypeDTO.PulseExercise ? "align-self: center;" : string.Empty)">
        @Message.Text
    </div>
}



@code {
    [Parameter]
    public MessageDTO Message { get; set; }

    [Parameter]
    public ChatDTO chat { get; set; }

    [CascadingParameter] 
    public IModalService Modal { get; set; } = default;

    [Parameter]
    public EventCallback CallBack { get; set; }

    private bool ModalOpened = false;

    protected override async Task OnParametersSetAsync()
    {
        if (Message.MessageType == MessageTypeDTO.PulseExercise && !ModalOpened)
        {
            ModalOpened = true;
            OpenExerciseModal();
        }
    }

    private async Task ChooseAnswerForQuestion(string question, string answer)
    {
        await httpClientService.PostToAPIAsync<MessageDTO>($"/chats/{chat.Id}/{question}/{answer}", null);
    }

    private string Styling => Message.MessageSenderType switch
    {
        MessageSenderTypeDTO.Patient => "Patient",
        _ => "DargeboteneHand"
    };

    private void OpenExerciseModal()
    {
        Modal.Show<BreathingExercise>();
    }
}
